<!-- HTML header for doxygen 1.14.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.16.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>aqnwb: Implementation of Data Recording ðŸ“Š</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">var page_layout=1;</script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom-modern.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="side-nav" class="ui-resizable side-nav-resizable"><!-- do not remove this div, it is closed by doxygen! -->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="aqnwb-logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">aqnwb<span id="projectnumber">&#160;0.2.0</span>
   </div>
  </td>
 </tr>
   <tr><td colspan="2">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect" class="search-icon" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()"><span class="search-icon-dropdown"></span></span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><div id="MSearchCloseImg" class="close-icon"></div></a>
          </span>
        </div>
</td></tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.16.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
</div><!-- top -->
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('record_design_page.html','',''); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search',true);
});
</script>
<div id="main-nav"></div>
<div id="container"><div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Implementation of Data Recording ðŸ“Š </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This page focuses on the software architecture of AqNWB for implementing data recording and is mainly aimed at software developers. The recording system in AqNWB is built around several key concepts:</p>
<ol type="1">
<li><b>Efficient data recording for individual datasets</b> via <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html" title="AQNWB::IO::BaseRecordingData">BaseRecordingData</a> objects discussed in <a class="el" href="#record_design_sec_recording_data" title="Recording datasets with BaseRecordingData">Recording datasets with BaseRecordingData</a></li>
<li><b>Consistent multi-dataset recording through convenience methods</b> defined on individual <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html" title="AQNWB::NWB::RegisteredType">RegisteredType</a> objects (e.g., <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_time_series.html#afb05f2252df2fc23d938894eb0bc6984" title="AQNWB::NWB::TimeSeries::writeData">TimeSeries::writeData</a>) discussed in <a class="el" href="#record_design_sec_timeseries" title="TimeSeries Convenience Methods for Consistent Recording">TimeSeries Convenience Methods for Consistent Recording</a></li>
<li><b>Managing collections of recording objects through RecordingObjects</b>, discussed in <a class="el" href="#record_design_sec_recording_containers" title="RecordingObjects for Managing Collections">RecordingObjects for Managing Collections</a></li>
</ol>
<h1 class="doxsection"><a class="anchor" id="record_design_sec_recording_data"></a>
Recording datasets with BaseRecordingData</h1>
<p>AqNWB records datasets efficiently via <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html" title="AQNWB::IO::BaseRecordingData">BaseRecordingData</a> objects. The main components involved in writing data to an NWB file via AqNWB are:</p>
<ol type="1">
<li><a class="el" href="_registered_type_8hpp.html#aeb21020579ca18f10e64fac9689a7ef6" title="DEFINE_DATASET_FIELD">DEFINE_DATASET_FIELD</a> Macro<ul>
<li>The <a class="el" href="_registered_type_8hpp.html#aeb21020579ca18f10e64fac9689a7ef6" title="DEFINE_DATASET_FIELD">DEFINE_DATASET_FIELD</a> macro not only defines methods for reading datasets for a particular neurodata_type (as described in <a class="el" href="read_design_page.html" title="Implementation of Data Read ðŸ“¤">Implementation of Data Read ðŸ“¤</a>), but also defines methods for retrieving <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html" title="AQNWB::IO::BaseRecordingData">BaseRecordingData</a> objects that are used for recording to individual datasets. For each dataset field defined with this macro, a corresponding method is generated that returns a <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html" title="AQNWB::IO::BaseRecordingData">BaseRecordingData</a> object configured for that specific dataset. The <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html" title="AQNWB::IO::BaseRecordingData">BaseRecordingData</a> objects are then cached by <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html" title="AQNWB::NWB::RegisteredType">RegisteredType</a> as described below.</li>
</ul>
</li>
<li><a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html" title="AQNWB::IO::BaseRecordingData">BaseRecordingData</a><ul>
<li><a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html" title="AQNWB::IO::BaseRecordingData">BaseRecordingData</a> is a class that manages the recording process for a dataset.</li>
<li>It keeps track of the current position in the dataset where data should be written next via the <span class="tt">m_position</span> member.</li>
<li>It provides methods for writing data blocks to the dataset, such as <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html#a24e2bbd5c76952a9237d046ddb2f7e93" title="AQNWB::IO::BaseRecordingData::writeDataBlock">writeDataBlock</a>, which can handle different data types and dimensions.</li>
</ul>
</li>
<li><a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html" title="AQNWB::NWB::RegisteredType">RegisteredType</a><ul>
<li><a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html" title="AQNWB::NWB::RegisteredType">RegisteredType</a> maintains a cache of <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html" title="AQNWB::IO::BaseRecordingData">BaseRecordingData</a> objects via the <span class="tt">m_recordingDataCache</span> member. This cache allows reusing the same <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html" title="AQNWB::IO::BaseRecordingData">BaseRecordingData</a> object when it is requested multiple times, improving performance and retaining the recording position. The cache is essential for writing data to the dataset in a streaming fashion, as it ensures that each write continues from where the previous write left off. The cache also avoids the need for manually maintaining the objects and allows caching of an arbitrary number of <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html" title="AQNWB::IO::BaseRecordingData">BaseRecordingData</a> object such that the individual neurodata_type classes do not need to worry about maintaining their recording state.</li>
</ul>
</li>
<li><a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_i_o.html" title="AQNWB::IO::BaseIO">BaseIO</a><ul>
<li><a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_i_o.html" title="AQNWB::IO::BaseIO">BaseIO</a> and its implementations (e.g., <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_h_d_f5_1_1_h_d_f5_i_o.html" title="AQNWB::IO::HDF5::HDF5IO">HDF5IO</a>) are responsible for the actual writing of data to disk. They provide methods for creating datasets (e.g., <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_i_o.html#a34edb8802204ec60e737113d4ccff1ef" title="AQNWB::IO::BaseIO::createArrayDataSet">createArrayDataSet</a>) and getting existing datasets (<a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_i_o.html#abfecddd0a4a45740ccc84edd7461dba9" title="AQNWB::IO::BaseIO::getDataSet">getDataSet</a>), both of which return <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html" title="AQNWB::IO::BaseRecordingData">BaseRecordingData</a> objects.</li>
</ul>
</li>
<li><a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_recording_objects.html" title="AQNWB::IO::RecordingObjects">RecordingObjects</a><ul>
<li>All <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html" title="AQNWB::NWB::RegisteredType">RegisteredType</a> objects used for recording are being registered with the <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_i_o.html#af5bcbe86c5258c1172cd9349f18654ad" title="AQNWB::IO::BaseIO::m_recording_objects">BaseIO::m_recording_objects</a> instance of <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_recording_objects.html" title="AQNWB::IO::RecordingObjects">RecordingObjects</a> to facilitate management of all objects used for recording.</li>
</ul>
</li>
</ol>
<div class="dotgraph">
<iframe scrolling="no" loading="lazy" frameborder="0" src="dot_inline_dotgraph_3d0a7586d1ace658b4daa8b088b2384f.svg" width="631" height="1095"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
<h2 class="doxsection"><a class="anchor" id="record_design_sec_define_dataset_field"></a>
The DEFINE_DATASET_FIELD Macro for Recording</h2>
<p>The <a class="el" href="_registered_type_8hpp.html#aeb21020579ca18f10e64fac9689a7ef6" title="DEFINE_DATASET_FIELD">DEFINE_DATASET_FIELD</a> macro not only defines methods for reading datasets but also for recording to them. For each dataset field defined with this macro, a corresponding method is generated that returns a <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html" title="AQNWB::IO::BaseRecordingData">BaseRecordingData</a> object configured for that specific dataset.</p>
<p>For example, if we have a <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_time_series.html" title="AQNWB::NWB::TimeSeries">TimeSeries</a> class with a 'data' field defined using the <a class="el" href="_registered_type_8hpp.html#aeb21020579ca18f10e64fac9689a7ef6" title="DEFINE_DATASET_FIELD">DEFINE_DATASET_FIELD</a> macro:</p>
<div class="fragment"><div class="line"><a class="code hl_define" href="_registered_type_8hpp.html#aeb21020579ca18f10e64fac9689a7ef6">DEFINE_DATASET_FIELD</a>(readData, recordData, std::any, <span class="stringliteral">&quot;data&quot;</span>, The main data)</div>
<div class="ttc" id="a_registered_type_8hpp_html_aeb21020579ca18f10e64fac9689a7ef6"><div class="ttname"><a href="_registered_type_8hpp.html#aeb21020579ca18f10e64fac9689a7ef6">DEFINE_DATASET_FIELD</a></div><div class="ttdeci">#define DEFINE_DATASET_FIELD(readName, writeName, default_type, fieldPath, description)</div><div class="ttdoc">Defines a lazy-loaded dataset field accessor function.</div><div class="ttdef"><b>Definition</b> RegisteredType.hpp:573</div></div>
</div><!-- fragment --><p>This generates not only a <span class="tt">readData()</span> method for reading the dataset but also a <span class="tt">recordData()</span> method that returns a <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html" title="AQNWB::IO::BaseRecordingData">BaseRecordingData</a> object configured for writing to the 'data' dataset.</p>
<p>The generated <span class="tt">recordData()</span> method:</p><ol type="1">
<li>Checks if a <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html" title="AQNWB::IO::BaseRecordingData">BaseRecordingData</a> object for the dataset already exists in the cache</li>
<li>If it exists and <span class="tt">reset</span> is false, returns the cached object</li>
<li>If it doesn't exist or <span class="tt">reset</span> is true, gets a new <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html" title="AQNWB::IO::BaseRecordingData">BaseRecordingData</a> object from the IO backend</li>
<li>Calls <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html#a9114e761cf006ec16c3733b9f8915f9d" title="AQNWB::NWB::RegisteredType::registerRecordingObject">RegisteredType::registerRecordingObject</a> to register the current <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html" title="AQNWB::NWB::RegisteredType">RegisteredType</a> object for recording with the I/O to make sure the object is being finalized at the end of the recording.</li>
<li>Caches the new object and returns it</li>
</ol>
<p>This caching mechanism is crucial for maintaining the recording state across multiple writes to the same dataset.</p>
<h2 class="doxsection"><a class="anchor" id="record_design_sec_baserecordingdata"></a>
BaseRecordingData for Managing Recording</h2>
<p>The <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html" title="AQNWB::IO::BaseRecordingData">BaseRecordingData</a> class is responsible for managing the recording process for a dataset. It keeps track of the current position in the dataset where data should be written next, ensuring that data is written efficiently, especially for streaming data where multiple writes occur over time.</p>
<p>Key features of <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html" title="AQNWB::IO::BaseRecordingData">BaseRecordingData</a> include:</p>
<ul>
<li><b>Position Tracking</b>: <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html" title="AQNWB::IO::BaseRecordingData">BaseRecordingData</a> keeps track of the current position in the dataset via the <span class="tt">m_position</span> member. This is particularly important for streaming data, where data is written in chunks over time.</li>
<li><b>Data Type Handling</b>: <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html" title="AQNWB::IO::BaseRecordingData">BaseRecordingData</a> can handle different data types and dimensions through its <span class="tt">writeDataBlock</span> methods, making it flexible for various types of data.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="record_design_sec_timeseries"></a>
TimeSeries Convenience Methods for Consistent Recording</h1>
<p>Specific types like <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_time_series.html" title="AQNWB::NWB::TimeSeries">TimeSeries</a> provide convenience methods for writing multiple datasets in a consistent manner. This ensures that related datasets (e.g., 'data' and 'timestamps' in a <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_time_series.html" title="AQNWB::NWB::TimeSeries">TimeSeries</a>) are written consistently and simplifies the recording process.</p>
<p>The <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_time_series.html" title="AQNWB::NWB::TimeSeries">TimeSeries</a> class provides:</p>
<ul>
<li>An <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_time_series.html#ab025c3806934a010991fb56c94945ab4" title="AQNWB::NWB::TimeSeries::initialize">initialize</a> method that sets up all the necessary datasets and attributes for a time series, including <span class="tt">data</span>, <span class="tt">timestamps</span>, <span class="tt">control</span> and all their attributes, e.g., <span class="tt">unit</span></li>
<li>A <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_time_series.html#afb05f2252df2fc23d938894eb0bc6984" title="AQNWB::NWB::TimeSeries::writeData">writeData</a> method that writes <span class="tt">data</span>, <span class="tt">timestamps</span>, and <span class="tt">control</span> information in a single call, ensuring consistency between these related datasets.</li>
</ul>
<p>These convenience methods handle the details of:</p>
<ul>
<li><b>Dataset Creation</b>: Creating the necessary datasets if they don't exist.</li>
<li><b>Data Alignment</b>: Ensuring that related datasets (e.g., data and timestamps) are properly aligned.</li>
<li><b>Position Management</b>: Managing the current position in each dataset to ensure consistent writing.</li>
<li><b>Error Handling</b>: Handling errors that might occur during the writing process.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="record_design_sec_recording_containers"></a>
RecordingObjects for Managing Collections</h1>
<p><a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_recording_objects.html" title="AQNWB::IO::RecordingObjects">RecordingObjects</a> provides an additional convenience layer for managing collections of <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html" title="AQNWB::NWB::RegisteredType">RegisteredType</a> Containers used for recording. This is particularly useful when recording data to multiple related containers, such as multiple <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_time_series.html" title="AQNWB::NWB::TimeSeries">TimeSeries</a> objects.</p>
<p><a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_recording_objects.html" title="AQNWB::IO::RecordingObjects">RecordingObjects</a> simplifies the process of:</p>
<ul>
<li><b>Container Management</b>: Adding and retrieving containers from the collection via <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_recording_objects.html#a01b77fd8404c44b40b98380c600bf996" title="AQNWB::IO::RecordingObjects::addRecordingObject">addRecordingObject</a> and <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_recording_objects.html#a01b77fd8404c44b40b98380c600bf996" title="AQNWB::IO::RecordingObjects::addRecordingObject">getRecordingObject</a> methods.</li>
<li><b>Finalization of recording objects:</b> via <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_recording_objects.html#ac5ca7864886ec0547a83bde8efcf0ac0" title="AQNWB::IO::RecordingObjects::finalize">finalize</a></li>
<li><b>Clearing of cached BaseRecordingData objects</b> via <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_recording_objects.html#a263c6a4f4976cdd8497e952d8d9ad444" title="AQNWB::IO::RecordingObjects::clearRecordingDataCache">clearRecordingDataCache</a>;</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="record_design_nwbio_utils"></a>
NWB I/O convenience utilities</h1>
<p>The <a class="el" href="nwbio__utils_8hpp.html" title="src/io/nwbio_utils.hpp">src/io/nwbio_utils.hpp</a> module provides convenience methods to help coordinating the recording process across multiple containers through specialized methods like:</p><ul>
<li><a class="el" href="namespace_a_q_n_w_b_1_1_i_o.html#acb284d332fd23c82aa8e8311dd31d319" title="AQNWB::IO::writeTimeseriesData">writeTimeseriesData</a>: For writing data to a <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_time_series.html" title="AQNWB::NWB::TimeSeries">TimeSeries</a> container</li>
<li><a class="el" href="namespace_a_q_n_w_b_1_1_i_o.html#a20c344888517796c27aabd7ca0d91209" title="AQNWB::IO::writeElectricalSeriesData">writeElectricalSeriesData</a>: For writing data to an <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_electrical_series.html" title="AQNWB::NWB::ElectricalSeries">ElectricalSeries</a> container</li>
<li><a class="el" href="namespace_a_q_n_w_b_1_1_i_o.html#a64543a3bdd0da0a54a2085aad3643089" title="AQNWB::IO::writeSpikeEventData">writeSpikeEventData</a>: For writing data to a <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_spike_event_series.html" title="AQNWB::NWB::SpikeEventSeries">SpikeEventSeries</a> container</li>
<li><a class="el" href="namespace_a_q_n_w_b_1_1_i_o.html#a274c97d36f16912ad3e3bb88e2b58bf5" title="AQNWB::IO::writeAnnotationSeriesData">writeAnnotationSeriesData</a>: For writing data to an <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_annotation_series.html" title="AQNWB::NWB::AnnotationSeries">AnnotationSeries</a> container</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="record_design_object_memory_management"></a>
Object and memory management</h1>
<ol type="1">
<li>The <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_i_o.html" title="AQNWB::IO::BaseIO">I/O</a> owns a <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_i_o.html#af5bcbe86c5258c1172cd9349f18654ad" title="AQNWB::IO::BaseIO::m_recording_objects">std::shared_ptr&lt;RecordingObjects&gt; m_recording_objects</a> smart pointer to its <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_recording_objects.html" title="AQNWB::IO::RecordingObjects">RecordingObjects</a></li>
<li>The <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_recording_objects.html" title="AQNWB::IO::RecordingObjects">RecordingObjects</a> instance in turn tracks the <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html" title="AQNWB::NWB::RegisteredType">RegisteredType</a> objects used for recroding with the I/O object by owning the <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html" title="AQNWB::NWB::RegisteredType">RegisteredType</a> objects stored in <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_recording_objects.html#a126b61632139fc46327c9f624605f4f2" title="AQNWB::IO::RecordingObjects::m_recording_objects">std::vector&lt;std::shared_ptr&lt;AQNWB::NWB::RegisteredType&gt;&gt; m_recording_objects</a></li>
<li><a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html" title="AQNWB::NWB::RegisteredType">RegisteredType</a> objects in turn have a <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html#a73f9bb35022892941b8b46a1669605da" title="AQNWB::NWB::RegisteredType::m_io">std::weak_ptr&lt;IO::BaseIO&gt; m_io</a> weak pointer to the I/O.</li>
</ol>
<dl class="section note"><dt>Note</dt><dd><a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html#a73f9bb35022892941b8b46a1669605da" title="AQNWB::NWB::RegisteredType::m_io">RegisteredType::m_io</a> is a <span class="tt">std::weak_ptr</span> to the I/O to avoid circular referencing between the <span class="tt">I/O--&gt;RecordingObjects--&gt;RegisteredType</span> and back to the <span class="tt">I/O</span>, which would prevent correct clean-up of the reference counted smart pointers, which would lead to memory leaks. This also means, that the <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html" title="AQNWB::NWB::RegisteredType">RegisteredType</a> object does not own or keep the I/O alive, so we need to check first that the I/O is valid when we use it.</dd></dl>
<p>In this logic, the I/O essentially owns the recording process and the user in turn owns the I/O object. To ensure reliable management of the objects, the constructors of all <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html" title="AQNWB::NWB::RegisteredType">RegisteredType</a> classes are protected, requiring the use of the <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html#a6f7d3d6d30763215c823452176ed876a" title="AQNWB::NWB::RegisteredType::create">RegisteredType::create</a> factory methods. This ensures that all instance of <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html" title="AQNWB::NWB::RegisteredType">RegisteredType</a> and its subclasses are created as smart <span class="tt">std::shared_ptr</span> pointers to facilitate reliable memory management.</p>
<dl class="section note"><dt>Note</dt><dd>Registration with the <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_recording_objects.html" title="AQNWB::IO::RecordingObjects">RecordingObjects</a> of the I/O occurs when a <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html" title="AQNWB::NWB::RegisteredType">RegisteredType</a> is being created via the static <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html#a6f7d3d6d30763215c823452176ed876a" title="AQNWB::NWB::RegisteredType::create">RegisteredType::create</a> factory methods.</dd></dl>
<h1 class="doxsection"><a class="anchor" id="recording_design_further_reading"></a>
Further Reading</h1>
<ul>
<li><a class="el" href="workflow.html" title="Acquiring Data ðŸ“Š">Acquiring Data ðŸ“Š</a> provides a step-by-step overview of the typical recording process.</li>
<li><a class="el" href="read_design_page.html" title="Implementation of Data Read ðŸ“¤">Implementation of Data Read ðŸ“¤</a> provides a complementary overview of how data read is implemented, which involves many of the same classes, but using <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_read_data_wrapper.html" title="AQNWB::IO::ReadDataWrapper">ReadDataWrapper</a> instead of <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html" title="AQNWB::IO::BaseRecordingData">BaseRecordingData</a> for accessing data.</li>
<li><a class="el" href="registered_type_page.html" title="Implementing a Registered Type ðŸ”§">Implementing a Registered Type ðŸ”§</a> discusess the use of <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html" title="AQNWB::NWB::RegisteredType">RegisteredType</a> to implement writing and reading of neurodata_types for NWB. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="devdocs.html">For Developers</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.16.1 </li>
  </ul>
</div>
</body>
</html>

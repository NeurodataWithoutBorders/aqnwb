<!-- HTML header for doxygen 1.14.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>aqnwb: Implementation of Data Recording</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">var page_layout=1;</script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom-modern.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="side-nav" class="ui-resizable side-nav-resizable"><!-- do not remove this div, it is closed by doxygen! -->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="aqnwb-logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">aqnwb<span id="projectnumber">&#160;0.1.0</span>
   </div>
  </td>
 </tr>
   <tr><td colspan="2">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect" class="search-icon" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()"><span class="search-icon-dropdown"></span></span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><div id="MSearchCloseImg" class="close-icon"></div></a>
          </span>
        </div>
</td></tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
</div><!-- top -->
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('record_design_page.html','',''); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search',true);
});
</script>
<div id="main-nav"></div>
<div id="container"><div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Implementation of Data Recording </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This page focuses on the software architecture of AqNWB for implementing data recording and is mainly aimed at software developers. The recording system in AqNWB is built around several key concepts:</p>
<ol type="1">
<li><b>Efficient data recording for individual datasets</b> via <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html">BaseRecordingData</a> objects discussed in <a class="el" href="#record_design_sec_recording_data">Recording datasets with BaseRecordingData</a></li>
<li><b>Consistent multi-dataset recording through convenience methods</b> defined on individual <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html">RegisteredType</a> objects (e.g., <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_time_series.html#a33c3c764fdf8a5db861beeabc48d78e7">TimeSeries::writeData</a>) discussed in <a class="el" href="#record_design_sec_timeseries">TimeSeries Convenience Methods for Consistent Recording</a></li>
<li><b>Managing collections of recording objects through RecordingContainers</b>, discussed in <a class="el" href="#record_design_sec_recording_containers">RecordingContainers for Managing Collections</a></li>
</ol>
<h1 class="doxsection"><a class="anchor" id="record_design_sec_recording_data"></a>
Recording datasets with BaseRecordingData</h1>
<p>AqNWB records datasets efficiently via <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html">BaseRecordingData</a> objects. The main components involved in writing data to an NWB file via AqNWB are:</p>
<ol type="1">
<li><a class="el" href="_registered_type_8hpp.html#aeb21020579ca18f10e64fac9689a7ef6">DEFINE_DATASET_FIELD</a> Macro<ul>
<li>The <a class="el" href="_registered_type_8hpp.html#aeb21020579ca18f10e64fac9689a7ef6">DEFINE_DATASET_FIELD</a> macro not only defines methods for reading datasets for a particular neurodata_type (as described in <a class="el" href="read_design_page.html">Implementation of Data Read ðŸ“¤</a>), but also defines methods for retrieving <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html">BaseRecordingData</a> objects that are used for recording to individual datasets. For each dataset field defined with this macro, a corresponding method is generated that returns a <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html">BaseRecordingData</a> object configured for that specific dataset. The <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html">BaseRecordingData</a> objects are then cached by <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html">RegisteredType</a> as described below.</li>
</ul>
</li>
<li><a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html">BaseRecordingData</a><ul>
<li><a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html">BaseRecordingData</a> is a class that manages the recording process for a dataset.</li>
<li>It keeps track of the current position in the dataset where data should be written next via the <span class="tt">m_position</span> member.</li>
<li>It provides methods for writing data blocks to the dataset, such as <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html#a9ca4dc596b124ad57e0a55674c1d37d2">writeDataBlock</a>, which can handle different data types and dimensions.</li>
</ul>
</li>
<li><a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html">RegisteredType</a><ul>
<li><a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html">RegisteredType</a> maintains a cache of <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html">BaseRecordingData</a> objects via the <span class="tt">m_recordingDataCache</span> member. This cache allows reusing the same <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html">BaseRecordingData</a> object when it is requested multiple times, improving performance and retaining the recording position. The cache is essential for writing data to the dataset in a streaming fashion, as it ensures that each write continues from where the previous write left off. The cache also avoids the need for manually maintaining the objects and allows caching of an arbitrary number of <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html">BaseRecordingData</a> object such that the individual neurodata_type classes do not need to worry about maintaining their recording state.</li>
</ul>
</li>
<li><a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_i_o.html">BaseIO</a><ul>
<li><a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_i_o.html">BaseIO</a> and its implementations (e.g., <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_h_d_f5_1_1_h_d_f5_i_o.html">HDF5IO</a>) are responsible for the actual writing of data to disk. They provide methods for creating datasets (e.g., <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_i_o.html#aacc45c55b5d653a8d8c64f26b7d7081e">createArrayDataSet</a>) and getting existing datasets (<a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_i_o.html#abfecddd0a4a45740ccc84edd7461dba9">getDataSet</a>), both of which return <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html">BaseRecordingData</a> objects.</li>
</ul>
</li>
</ol>
<div class="dotgraph">
<iframe scrolling="no" loading="lazy" frameborder="0" src="dot_inline_dotgraph_4.svg" width="588" height="1066"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
<h2 class="doxsection"><a class="anchor" id="record_design_sec_define_dataset_field"></a>
The DEFINE_DATASET_FIELD Macro for Recording</h2>
<p>The <a class="el" href="_registered_type_8hpp.html#aeb21020579ca18f10e64fac9689a7ef6">DEFINE_DATASET_FIELD</a> macro not only defines methods for reading datasets but also for recording to them. For each dataset field defined with this macro, a corresponding method is generated that returns a <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html">BaseRecordingData</a> object configured for that specific dataset.</p>
<p>For example, if we have a <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_time_series.html">TimeSeries</a> class with a 'data' field defined using the <a class="el" href="_registered_type_8hpp.html#aeb21020579ca18f10e64fac9689a7ef6">DEFINE_DATASET_FIELD</a> macro:</p>
<div class="fragment"><div class="line"><a class="code hl_define" href="_registered_type_8hpp.html#aeb21020579ca18f10e64fac9689a7ef6">DEFINE_DATASET_FIELD</a>(readData, recordData, std::any, <span class="stringliteral">&quot;data&quot;</span>, The main data)</div>
<div class="ttc" id="a_registered_type_8hpp_html_aeb21020579ca18f10e64fac9689a7ef6"><div class="ttname"><a href="_registered_type_8hpp.html#aeb21020579ca18f10e64fac9689a7ef6">DEFINE_DATASET_FIELD</a></div><div class="ttdeci">#define DEFINE_DATASET_FIELD(readName, writeName, default_type, fieldPath, description)</div><div class="ttdoc">Defines a lazy-loaded dataset field accessor function.</div><div class="ttdef"><b>Definition</b> RegisteredType.hpp:475</div></div>
</div><!-- fragment --><p>This generates not only a <span class="tt">readData()</span> method for reading the dataset but also a <span class="tt">recordData()</span> method that returns a <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html">BaseRecordingData</a> object configured for writing to the 'data' dataset.</p>
<p>The generated <span class="tt">recordData()</span> method:</p><ol type="1">
<li>Checks if a <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html">BaseRecordingData</a> object for the dataset already exists in the cache</li>
<li>If it exists and <span class="tt">reset</span> is false, returns the cached object</li>
<li>If it doesn't exist or <span class="tt">reset</span> is true, gets a new <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html">BaseRecordingData</a> object from the IO backend</li>
<li>Caches the new object and returns it</li>
</ol>
<p>This caching mechanism is crucial for maintaining the recording state across multiple writes to the same dataset.</p>
<h2 class="doxsection"><a class="anchor" id="record_design_sec_baserecordingdata"></a>
BaseRecordingData for Managing Recording</h2>
<p>The <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html">BaseRecordingData</a> class is responsible for managing the recording process for a dataset. It keeps track of the current position in the dataset where data should be written next, ensuring that data is written efficiently, especially for streaming data where multiple writes occur over time.</p>
<p>Key features of <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html">BaseRecordingData</a> include:</p>
<ul>
<li><b>Position Tracking</b>: <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html">BaseRecordingData</a> keeps track of the current position in the dataset via the <span class="tt">m_position</span> member. This is particularly important for streaming data, where data is written in chunks over time.</li>
<li><b>Data Type Handling</b>: <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html">BaseRecordingData</a> can handle different data types and dimensions through its <span class="tt">writeDataBlock</span> methods, making it flexible for various types of data.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="record_design_sec_timeseries"></a>
TimeSeries Convenience Methods for Consistent Recording</h1>
<p>Specific types like <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_time_series.html">TimeSeries</a> provide convenience methods for writing multiple datasets in a consistent manner. This ensures that related datasets (e.g., 'data' and 'timestamps' in a <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_time_series.html">TimeSeries</a>) are written consistently and simplifies the recording process.</p>
<p>The <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_time_series.html">TimeSeries</a> class provides:</p>
<ul>
<li>An <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_time_series.html#a5758bc49963971c9bc8fa2e7287fcd81">initialize</a> method that sets up all the necessary datasets and attributes for a time series, including <span class="tt">data</span>, <span class="tt">timestamps</span>, <span class="tt">control</span> and all their attributes, e.g., <span class="tt">unit</span></li>
<li>A <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_time_series.html#a33c3c764fdf8a5db861beeabc48d78e7">writeData</a> method that writes <span class="tt">data</span>, <span class="tt">timestamps</span>, and <span class="tt">control</span> information in a single call, ensuring consistency between these related datasets.</li>
</ul>
<p>These convenience methods handle the details of:</p>
<ul>
<li><b>Dataset Creation</b>: Creating the necessary datasets if they don't exist.</li>
<li><b>Data Alignment</b>: Ensuring that related datasets (e.g., data and timestamps) are properly aligned.</li>
<li><b>Position Management</b>: Managing the current position in each dataset to ensure consistent writing.</li>
<li><b>Error Handling</b>: Handling errors that might occur during the writing process.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="record_design_sec_recording_containers"></a>
RecordingContainers for Managing Collections</h1>
<p><a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_recording_containers.html">RecordingContainers</a> provides an additional convenience layer for managing collections of <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html">RegisteredType</a> Containers used for recording. This is particularly useful when recording data to multiple related containers, such as multiple <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_time_series.html">TimeSeries</a> objects.</p>
<p><a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_recording_containers.html">RecordingContainers</a> simplifies the process of:</p>
<ul>
<li><b>Container Management</b>: Adding and retrieving containers from the collection via <span class="tt">addContainer</span> and <span class="tt">getContainer</span> methods.</li>
<li><b>Coordinated Recording</b>: Coordinating the recording process across multiple containers through specialized methods like:<ul>
<li><span class="tt">writeTimeseriesData</span>: For writing data to a <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_time_series.html">TimeSeries</a> container</li>
<li><span class="tt">writeElectricalSeriesData</span>: For writing data to an ElectricalSeries container</li>
<li><span class="tt">writeSpikeEventData</span>: For writing data to a SpikeEventSeries container</li>
<li><span class="tt">writeAnnotationSeriesData</span>: For writing data to an AnnotationSeries container</li>
</ul>
</li>
<li><b>Error Handling</b>: Handling errors that might occur during the recording process across multiple containers.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="recording_design_further_reading"></a>
Further Reading</h1>
<ul>
<li><a class="el" href="workflow.html">Acquiring Data ðŸ“Š</a> provides a step-by-step overview of the typical recording process.</li>
<li><a class="el" href="read_design_page.html">Implementation of Data Read ðŸ“¤</a> provides a complementary overview of how data read is implemented, which involves many of the same classes, but using <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_read_data_wrapper.html">ReadDataWrapper</a> instead of <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_base_recording_data.html">BaseRecordingData</a> for accessing data.</li>
<li><a class="el" href="registered_type_page.html">Implementing a Registered Type ðŸ”§</a> discusess the use of <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html">RegisteredType</a> to implement writing and reading of neurodata_types for NWB. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="devdocs.html">For Developers</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>

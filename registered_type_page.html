<!-- HTML header for doxygen 1.11.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>aqnwb: Implementing a new Neurodata Type</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow" >
  <td id="projectlogo"><img alt="Logo" src="aqnwb-logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">aqnwb<span id="projectnumber">&#160;0.1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('registered_type_page.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Implementing a new Neurodata Type</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul>
  <li class="level1">
    <a href="#implement_registered_type">How to Implement a RegisteredType</a>
    <ul>
      <li class="level2">
        <a href="#implement_registered_type_example">Example: Implementing a new type</a>
      </li>
    </ul>
  </li>
  <li class="level1">
    <a href="#type_registry">How the Type Registry in RegisteredType Works</a>
  </li>
  <li class="level1">
    <a href="#use_registered_type_registry">How to Use the RegisteredType Registry</a>
    <ul>
      <li class="level2">
        <a href="#use_registered_type_registry_example">Example: Using the type registry</a>
      </li>
    </ul>
  </li>
  <li class="level1">
    <a href="#use_the_define_field_macro">How to Use the DEFINE_FIELD macro</a>
  </li>
</ul>
</div>
<div class="textblock"><p>New neurodata_types typically inherit from at least either <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_container.html">Container</a> or <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_data.html">Data</a>, or a more specialized type of the two. In any case, all classes that represent a <code>neurodata_type</code> defined in the schema should be implemented as a subtype of <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html">RegisteredType</a>.</p>
<h1><a class="anchor" id="implement_registered_type"></a>
How to Implement a RegisteredType</h1>
<p>To implement a subclass of <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html">RegisteredType</a>, follow these steps:</p>
<ol type="1">
<li>Include the <code><a class="el" href="_registered_type_8hpp.html">RegisteredType.hpp</a></code> header file in your subclass header file. <div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_registered_type_8hpp.html">nwb/RegisteredType.hpp</a>&quot;</span></div>
<div class="ttc" id="a_registered_type_8hpp_html"><div class="ttname"><a href="_registered_type_8hpp.html">RegisteredType.hpp</a></div></div>
</div><!-- fragment --></li>
<li>Define your subclass by inheriting from <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html">RegisteredType</a>. Ensure that your subclass implements a constructor with the arguments <code>(const std::string&amp; path, std::shared_ptr&lt;IO::BaseIO&gt; io)</code>, as the "create" method expects this constructor signature. <div class="fragment"><div class="line"><span class="keyword">class </span>MySubClass : <span class="keyword">public</span> <a class="code hl_class" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html">AQNWB::NWB::RegisteredType</a> {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    MySubClass(<span class="keyword">const</span> std::string&amp; path, std::shared_ptr&lt;IO::BaseIO&gt; io)</div>
<div class="line">        : RegisteredType(path, io) {}</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Implement any additional methods or overrides here</span></div>
<div class="line">};</div>
<div class="ttc" id="aclass_a_q_n_w_b_1_1_n_w_b_1_1_registered_type_html"><div class="ttname"><a href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html">AQNWB::NWB::RegisteredType</a></div><div class="ttdoc">Base class for types defined in the NWB schema.</div><div class="ttdef"><b>Definition</b> RegisteredType.hpp:47</div></div>
</div><!-- fragment --></li>
<li>Use the <a class="el" href="_registered_type_8hpp.html#a9c1f79aa46baaf33d1bf885cf7484aa1">REGISTER_SUBCLASS</a> macro to register your subclass. This should usually appear in the header (<code>hpp</code>) file as part of the class definition: <div class="fragment"><div class="line"><a class="code hl_define" href="_registered_type_8hpp.html#a9c1f79aa46baaf33d1bf885cf7484aa1">REGISTER_SUBCLASS</a>(MySubClass, <span class="stringliteral">&quot;my-namespace&quot;</span>)</div>
<div class="ttc" id="a_registered_type_8hpp_html_a9c1f79aa46baaf33d1bf885cf7484aa1"><div class="ttname"><a href="_registered_type_8hpp.html#a9c1f79aa46baaf33d1bf885cf7484aa1">REGISTER_SUBCLASS</a></div><div class="ttdeci">#define REGISTER_SUBCLASS(T, NAMESPACE)</div><div class="ttdoc">Macro to register a subclass with the RegisteredType class registry.</div><div class="ttdef"><b>Definition</b> RegisteredType.hpp:276</div></div>
</div><!-- fragment --></li>
<li>In the corresponding source (<code>cpp</code>) file, initialize the static member to trigger the registration using the <a class="el" href="_registered_type_8hpp.html#a54ea7671d2bcf5bae392b8ba1824961e">REGISTER_SUBCLASS_IMPL</a> macro: <div class="fragment"><div class="line"><span class="preprocessor">#include &quot;MySubClass.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Initialize the static member to trigger registration</span></div>
<div class="line"><a class="code hl_define" href="_registered_type_8hpp.html#a54ea7671d2bcf5bae392b8ba1824961e">REGISTER_SUBCLASS_IMPL</a>(MySubClass)</div>
<div class="ttc" id="a_registered_type_8hpp_html_a54ea7671d2bcf5bae392b8ba1824961e"><div class="ttname"><a href="_registered_type_8hpp.html#a54ea7671d2bcf5bae392b8ba1824961e">REGISTER_SUBCLASS_IMPL</a></div><div class="ttdeci">#define REGISTER_SUBCLASS_IMPL(T)</div><div class="ttdoc">Macro to initialize the static member registered_ to trigger registration.</div><div class="ttdef"><b>Definition</b> RegisteredType.hpp:288</div></div>
</div><!-- fragment --></li>
<li>To define getter methods for lazy read access to datasets and attributes that belong to our type, we can use the <a class="el" href="_registered_type_8hpp.html#acd3c876a1c357333cd4a8ff27300ee08">DEFINE_FIELD</a> macro. This macro creates a standard method for retrieving a <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_read_data_wrapper.html">ReadDataWrapper</a> for lazy reading for the field: <div class="fragment"><div class="line"><a class="code hl_define" href="_registered_type_8hpp.html#acd3c876a1c357333cd4a8ff27300ee08">DEFINE_FIELD</a>(getData, DatasetField, <span class="keywordtype">float</span>, <span class="stringliteral">&quot;data&quot;</span>, The main data)</div>
<div class="ttc" id="a_registered_type_8hpp_html_acd3c876a1c357333cd4a8ff27300ee08"><div class="ttname"><a href="_registered_type_8hpp.html#acd3c876a1c357333cd4a8ff27300ee08">DEFINE_FIELD</a></div><div class="ttdeci">#define DEFINE_FIELD(name, storageObjectType, default_type, fieldPath, description)</div><div class="ttdoc">Defines a lazy-loaded field accessor function.</div><div class="ttdef"><b>Definition</b> RegisteredType.hpp:310</div></div>
</div><!-- fragment --></li>
</ol>
<dl class="section warning"><dt>Warning</dt><dd>To ensure proper function on read, the name of the class should match the name of the <code>neurodata_type</code> as defined in the schema. Similarly, "my-namespace" should match the name of the namespace in the schema (e.g., "core", "hdmf-common"). In this way we can look up the corresponding class for an object in a file based on the <code>neurodata_type</code> and <code>namespace</code> attributes stored in the file.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>A special version of the <code>REGISTER_SUBCLASS</code> macro, called <code>REGISTER_SUBCLASS_WITH_TYPENAME</code>, allows setting the typename explicitly as a third argument. This is for the <b>special case</b> where we want to implement a class for a modified type that does not have its own <code>neurodata_type</code> in the NWB schema. An example is <code>ElectrodesTable</code> in NWB &lt;v2.7, which did not have an assigned <code>neurodata_type</code>, but was implemented as a regular <code>DynamicTable</code>. To allow us to define a class <code>ElectrodeTable</code> to help with writing the table we can then use <code>REGISTER_SUBCLASS_WITH_TYPENAME(ElectrodeTable, "core", "DynamicTable")</code> in the <code>ElectrodesTable</code> class. This ensures that the <code>neurodata_type</code> attribute is set correctly to <code>DynamicTable</code> on write instead of <code>ElectrodesTable</code>. However, on read this will by default not use the <code>ElectrodesTable</code> class but the regular <code>DynamicTable</code> class since that is what the schema is indicating to use. In the registry, the class will still be registered under the <code>core::ElectrodesTable</code> key, but with "DynamicTable" as the typename value and the <code>ElectrodesTable.getTypeName</code> automatic override returning the indicated typename instead of the classname.</dd>
<dd>
<code>DEFINE_FIELD</code> creates templated, non-virtual read functions. This means if we want to "redefine" a field in a child class by calling <code>DEFINE_FIELD</code> again, then the function will be "hidden" instead of "override". This is important to remember when casting a pointer to a base type, as in this case the implementation from the base type will be used since the function created by <code>DEFINE_FIELD</code> is not virtual.</dd></dl>
<h2><a class="anchor" id="implement_registered_type_example"></a>
Example: Implementing a new type</h2>
<p><em>MySubClass.hpp</em> </p><div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_registered_type_8hpp.html">RegisteredType.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>MySubClass : <span class="keyword">public</span> <a class="code hl_class" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html">AQNWB::NWB::RegisteredType</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    MySubClass(<span class="keyword">const</span> std::string&amp; path, std::shared_ptr&lt;IO::BaseIO&gt; io)</div>
<div class="line">        : RegisteredType(path, io) {}</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="_registered_type_8hpp.html#acd3c876a1c357333cd4a8ff27300ee08">DEFINE_FIELD</a>(getData, DatasetField, <span class="keywordtype">float</span>, <span class="stringliteral">&quot;data&quot;</span>, The main data)</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="_registered_type_8hpp.html#a9c1f79aa46baaf33d1bf885cf7484aa1">REGISTER_SUBCLASS</a>(MySubClass, <span class="stringliteral">&quot;my-namespace&quot;</span>)</div>
<div class="line">};</div>
</div><!-- fragment --><p><em>MySubClass.cpp</em> </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;MySubClass.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Initialize the static member to trigger registration</span></div>
<div class="line"><a class="code hl_define" href="_registered_type_8hpp.html#a54ea7671d2bcf5bae392b8ba1824961e">REGISTER_SUBCLASS_IMPL</a>(MySubClass)</div>
</div><!-- fragment --><h1><a class="anchor" id="type_registry"></a>
How the Type Registry in RegisteredType Works</h1>
<p>The type registry in <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html">RegisteredType</a> allows for dynamic creation of registered subclasses by name. Here is how it works:</p>
<ol type="1">
<li><b>Registry Storage</b>:<ul>
<li>The registry is implemented using 1) an <code>std::unordered_set</code> to store subclass names (which can be accessed via <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html#ab7e3361637885fe601cc20cb342bf01c">getRegistry()</a>) and 2) an <code>std::unordered_map</code> to store factory functions for creating instances of the subclasses (which can be accessed via <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html#a8792fccbd49f9d441b1f6d5a1b06b4cf">getFactoryMap()</a>). The factory methods are the required constructor that uses the io and path as input.</li>
<li>These are defined as static members within the <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html">RegisteredType</a> class.</li>
</ul>
</li>
<li><b>Registration</b>:<ul>
<li>The <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html#acb4c10e5b18c0c637de8bccd8d13e1dc">registerSubclass</a> method is used to add a subclass name and its corresponding factory function to the registry.</li>
<li>This method is called via the <code>REGISTER_SUBCLASS</code> macro, which defines a static method (<code>registerSubclass()</code>) and static member (<code>registered_</code>) to trigger the registration when the subclass is loaded.</li>
</ul>
</li>
<li><b>Dynamic Creation</b>:<ul>
<li>The <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html#a01354d1b4230f7495203cc526eae418f">create</a> method is used to create an instance of a registered subclass by name.</li>
<li>This method looks up the subclass name in the registry and calls the corresponding factory function to create an instance.</li>
</ul>
</li>
<li><b>Automatic Registration</b>:<ul>
<li>The <code>REGISTER_SUBCLASS_IMPL</code> macro initializes the static member (<code>registered_</code>), which triggers the <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html#acb4c10e5b18c0c637de8bccd8d13e1dc">registerSubclass</a> method and ensures that the subclass is registered when the program starts.</li>
</ul>
</li>
<li><b>Class Name and Namespace Retrieval</b>:<ul>
<li>The <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html#a150f881ad61cb8352eea7ddba47bc6ad">getTypeName</a> and <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html#a651f3d7e5cc28dc93888e8a821c5aa1c">getNamespace</a> return the string name of the class and namespace, respectively. The <code>REGISTER_SUBCLASS</code> macro implements an automatic override of the methods to ensure the appropriate type and namespace string are returned. These methods should, hence, not be manually overridden by subclasses, to ensure consistency in type identification.</li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="use_registered_type_registry"></a>
How to Use the RegisteredType Registry</h1>
<p>The <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html">RegisteredType</a> registry allows for dynamic creation and management of registered subclasses. Here is how you can use it:</p>
<ol type="1">
<li><b>Creating Instances Dynamically</b>:<ul>
<li>Use the <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html#a01354d1b4230f7495203cc526eae418f">create</a> method to create an instance of a registered subclass by name.</li>
<li>This method takes the subclass name, path, and a shared pointer to the IO object as arguments. This illustrates how we can read a specific typed object in an NWB file. <div class="fragment"><div class="line">    <span class="comment">// Create an instance of an TimeSeries in a file.</span></div>
<div class="line">    <span class="keyword">auto</span> instance =</div>
<div class="line">        <a class="code hl_function" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html#a01354d1b4230f7495203cc526eae418f">AQNWB::NWB::RegisteredType::create</a>(<span class="stringliteral">&quot;core::TimeSeries&quot;</span>, dataPath, io);</div>
<div class="line">    REQUIRE(instance != <span class="keyword">nullptr</span>);</div>
</div><!-- fragment --></li>
</ul>
</li>
<li><b>Retrieving Registered Subclass Names</b>:<ul>
<li>Use the <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html#ab7e3361637885fe601cc20cb342bf01c">getRegistry</a> method to retrieve the set of registered subclass names. <div class="fragment"><div class="line">    <span class="comment">// Retrieve and print registered subclass names</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; registry = <a class="code hl_function" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html#ab7e3361637885fe601cc20cb342bf01c">AQNWB::NWB::RegisteredType::getRegistry</a>();</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Registered subclasses:&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; subclassName : registry) {</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot; - &quot;</span> &lt;&lt; subclassName &lt;&lt; std::endl;</div>
<div class="line">    }</div>
</div><!-- fragment --></li>
</ul>
</li>
<li><b>Retrieving the Factory Map</b>:<ul>
<li>Use the <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html#a8792fccbd49f9d441b1f6d5a1b06b4cf">getFactoryMap</a> method to retrieve the map of factory functions for creating instances of registered subclasses. <div class="fragment"><div class="line">    <span class="comment">// Retrieve and print factory map</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; factoryMap = <a class="code hl_function" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html#a8792fccbd49f9d441b1f6d5a1b06b4cf">AQNWB::NWB::RegisteredType::getFactoryMap</a>();</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Factory functions for registered subclasses:&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; pair : factoryMap) {</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot; - &quot;</span> &lt;&lt; pair.first &lt;&lt; std::endl;</div>
<div class="line">    }</div>
</div><!-- fragment --></li>
</ul>
</li>
</ol>
<h2><a class="anchor" id="use_registered_type_registry_example"></a>
Example: Using the type registry</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_base_i_o_8hpp.html">io/BaseIO.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_h_d_f5_i_o_8hpp.html">io/hdf5/HDF5IO.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_h_d_f5_recording_data_8hpp.html">io/hdf5/HDF5RecordingData.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_registered_type_8hpp.html">nwb/RegisteredType.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_time_series_8hpp.html">nwb/base/TimeSeries.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;testUtils.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespace_a_q_n_w_b_1_1_n_w_b.html">AQNWB::NWB</a>;</div>
<div class="line"> </div>
<div class="line">TEST_CASE(<span class="stringliteral">&quot;RegisterType Example&quot;</span>, <span class="stringliteral">&quot;[base]&quot;</span>)</div>
<div class="line">{</div>
<div class="line">  SECTION(<span class="stringliteral">&quot;Example to illustrate how the RegisterType registry is working&quot;</span>)</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// [example_RegisterType_setup_file]</span></div>
<div class="line">    <span class="comment">// Mock data</span></div>
<div class="line">    <a class="code hl_typedef" href="_channel_8hpp.html#aa890fbdbba8cf62d61a471a1f84537e9">SizeType</a> numSamples = 10;</div>
<div class="line">    std::string dataPath = <span class="stringliteral">&quot;/tsdata&quot;</span>;</div>
<div class="line">    std::vector&lt;SizeType&gt; dataShape = {numSamples};</div>
<div class="line">    std::vector&lt;SizeType&gt; positionOffset = {0};</div>
<div class="line">    BaseDataType dataType = BaseDataType::F32;</div>
<div class="line">    std::vector&lt;float&gt; data = getMockData1D(numSamples);</div>
<div class="line">    std::vector&lt;double&gt; timestamps = getMockTimestamps(numSamples, 1);</div>
<div class="line"> </div>
<div class="line">    std::string filename = getTestFilePath(<span class="stringliteral">&quot;testRegisteredTypeExample.h5&quot;</span>);</div>
<div class="line">    std::shared_ptr&lt;BaseIO&gt; io = std::make_unique&lt;IO::HDF5::HDF5IO&gt;(filename);</div>
<div class="line">    io-&gt;open();</div>
<div class="line">    <a class="code hl_class" href="class_a_q_n_w_b_1_1_n_w_b_1_1_time_series.html">NWB::TimeSeries</a> ts = <a class="code hl_class" href="class_a_q_n_w_b_1_1_n_w_b_1_1_time_series.html">NWB::TimeSeries</a>(dataPath, io);</div>
<div class="line">    ts.<a class="code hl_function" href="class_a_q_n_w_b_1_1_n_w_b_1_1_time_series.html#a9be940f3782a051785f27636a004b79f">initialize</a>(dataType, <span class="stringliteral">&quot;unit&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Write data to file</span></div>
<div class="line">    <a class="code hl_typedef" href="_base_i_o_8hpp.html#a38fce1d86c801b13b6860d3346276776">Status</a> writeStatus =</div>
<div class="line">        ts.<a class="code hl_function" href="class_a_q_n_w_b_1_1_n_w_b_1_1_time_series.html#a33c3c764fdf8a5db861beeabc48d78e7">writeData</a>(dataShape, positionOffset, data.data(), timestamps.data());</div>
<div class="line">    REQUIRE(writeStatus == Status::Success);</div>
<div class="line">    io-&gt;flush();</div>
<div class="line">    <span class="comment">// [example_RegisterType_setup_file]</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// [example_RegisterType_get_type_instance]</span></div>
<div class="line">    <span class="comment">// Create an instance of an TimeSeries in a file.</span></div>
<div class="line">    <span class="keyword">auto</span> instance =</div>
<div class="line">        <a class="code hl_function" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html#a01354d1b4230f7495203cc526eae418f">AQNWB::NWB::RegisteredType::create</a>(<span class="stringliteral">&quot;core::TimeSeries&quot;</span>, dataPath, io);</div>
<div class="line">    REQUIRE(instance != <span class="keyword">nullptr</span>);</div>
<div class="line">    <span class="comment">// [example_RegisterType_get_type_instance]</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// [example_RegisterType_get_registered_names]</span></div>
<div class="line">    <span class="comment">// Retrieve and print registered subclass names</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; registry = <a class="code hl_function" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html#ab7e3361637885fe601cc20cb342bf01c">AQNWB::NWB::RegisteredType::getRegistry</a>();</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Registered subclasses:&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; subclassName : registry) {</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot; - &quot;</span> &lt;&lt; subclassName &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">// [example_RegisterType_get_registered_names]</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// [example_RegisterType_get_registered_factories]</span></div>
<div class="line">    <span class="comment">// Retrieve and print factory map</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; factoryMap = <a class="code hl_function" href="class_a_q_n_w_b_1_1_n_w_b_1_1_registered_type.html#a8792fccbd49f9d441b1f6d5a1b06b4cf">AQNWB::NWB::RegisteredType::getFactoryMap</a>();</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Factory functions for registered subclasses:&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; pair : factoryMap) {</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot; - &quot;</span> &lt;&lt; pair.first &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">// [example_RegisterType_get_registered_factories]</span></div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
</div><!-- fragment --><h1><a class="anchor" id="use_the_define_field_macro"></a>
How to Use the DEFINE_FIELD macro</h1>
<p>The <a class="el" href="_registered_type_8hpp.html#acd3c876a1c357333cd4a8ff27300ee08">DEFINE_FIELD</a> macro takes the following main inputs:</p>
<ul>
<li><code>name</code>: The name of the function to generate.</li>
<li><code>storageObjectType</code> : One of either <a class="el" href="namespace_a_q_n_w_b_1_1_n_w_b.html#acfd896b65a7f56c25b3730a6e8dc80ca">DatasetField</a> or <a class="el" href="namespace_a_q_n_w_b_1_1_n_w_b.html#a4a7413b10eb1a838f0349fc59b5a333f">AttributeField</a> to define the type of storage object used to store the field.</li>
<li><code>default_type</code> : The default data type to use. If not known, we can use <code>std::any</code>.</li>
<li><code>fieldPath</code> : Literal string with the relative path to the field within the schema of the respective neurodata_type. This is automatically being expanded at runtime to the full path.</li>
<li><code>description</code> : Description of the field to include in the docstring for the docs</li>
</ul>
<p>All of these inputs are required. A typical example will look as follows:</p>
<div class="fragment"><div class="line"><a class="code hl_define" href="_registered_type_8hpp.html#acd3c876a1c357333cd4a8ff27300ee08">DEFINE_FIELD</a>(getData, DatasetField, <span class="keywordtype">float</span>, <span class="stringliteral">&quot;data&quot;</span>, The main data)</div>
</div><!-- fragment --><p>The compiler will then expand this definition to create a new method called <code>getData</code> that will return a <a class="el" href="class_a_q_n_w_b_1_1_i_o_1_1_read_data_wrapper.html">ReadDataWrapper</a> for lazy reading for the field. The corresponding expanded function will look something like:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> VTYPE = <span class="keywordtype">float</span>&gt;</div>
<div class="line"><span class="keyword">inline</span> std::unique_ptr&lt;IO::ReadDataWrapper&lt;DatasetField, VTYPE&gt;&gt; getData()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <span class="keywordflow">return</span> std::make_unique&lt;IO::ReadDataWrapper&lt;DatasetField, VTYPE&gt;&gt;(</div>
<div class="line">         m_io,</div>
<div class="line">         <a class="code hl_function" href="namespace_a_q_n_w_b.html#a31983dbaaa85c2e355b9687fc0ef1881">AQNWB::mergePaths</a>(m_path, fieldPath));</div>
<div class="line">}</div>
<div class="ttc" id="anamespace_a_q_n_w_b_html_a31983dbaaa85c2e355b9687fc0ef1881"><div class="ttname"><a href="namespace_a_q_n_w_b.html#a31983dbaaa85c2e355b9687fc0ef1881">AQNWB::mergePaths</a></div><div class="ttdeci">static std::string mergePaths(const std::string &amp;path1, const std::string &amp;path2)</div><div class="ttdoc">Merge two paths into a single path, handling extra trailing and starting &quot;/&quot;.</div><div class="ttdef"><b>Definition</b> Utils.hpp:91</div></div>
</div><!-- fragment --><p>See <a class="el" href="read_page.html">Reading data</a> for an example of how to use such methods (e.g., <a class="el" href="class_a_q_n_w_b_1_1_n_w_b_1_1_time_series.html#a8a43d4c249f6865ee4f77c58a91b6546">TimeSeries::readData</a> ) for reading data fields from a file. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="devdocs.html">For Developers</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
